<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>JSON2Table - Performance Test (Large Dataset)</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            line-height: 1.6;
        }
        .header {
            text-align: center;
            margin-bottom: 40px;
            padding: 20px;
            background: linear-gradient(135deg, #10b981 0%, #059669 100%);
            color: white;
            border-radius: 10px;
        }
        .performance-info {
            background: #f0fdf4;
            padding: 20px;
            border-radius: 8px;
            margin-bottom: 30px;
            border-left: 4px solid #10b981;
        }
        .benchmark {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin: 20px 0;
        }
        .metric {
            background: white;
            padding: 15px;
            border-radius: 8px;
            border: 1px solid #d1fae5;
            text-align: center;
        }
        .metric-value {
            font-size: 24px;
            font-weight: bold;
            color: #059669;
        }
        .metric-label {
            font-size: 12px;
            color: #6b7280;
            margin-top: 5px;
        }
        .warning {
            background: #fef3c7;
            padding: 15px;
            border-radius: 6px;
            border-left: 4px solid #f59e0b;
            margin: 20px 0;
        }
    </style>
</head>
<body>
    <div class="header">
        <h1>‚ö° High-Performance JSON2Table</h1>
        <p>Testing with 10,000+ records - Optimized for Speed</p>
    </div>

    <div class="performance-info">
        <h3>üöÄ Performance Optimizations Implemented:</h3>
        <div class="benchmark">
            <div class="metric">
                <div class="metric-value">Fixed</div>
                <div class="metric-label">Row Heights</div>
            </div>
            <div class="metric">
                <div class="metric-value">60fps</div>
                <div class="metric-label">Scroll Throttling</div>
            </div>
            <div class="metric">
                <div class="metric-value">1000</div>
                <div class="metric-label">Render Cache Limit</div>
            </div>
            <div class="metric">
                <div class="metric-value">Modal</div>
                <div class="metric-label">Object Expansion</div>
            </div>
            <div class="metric">
                <div class="metric-value">JSON.stringify</div>
                <div class="metric-label">Fast Search</div>
            </div>
            <div class="metric">
                <div class="metric-value">RAF</div>
                <div class="metric-label">Render Scheduling</div>
            </div>
        </div>
    </div>

    <div class="warning">
        <strong>‚ö†Ô∏è Large Dataset Notice:</strong> This page contains 10,000 synthetic records to test performance. 
        The extension should handle this smoothly with <100ms initial render and smooth 60fps scrolling.
    </div>

    <div style="background: #e0f2fe; padding: 15px; border-radius: 6px; margin-bottom: 20px; border-left: 4px solid #0284c7;">
        <strong>How to Test Performance:</strong>
        <ol>
            <li>Install and activate the JSON2Table extension</li>
            <li>Click the extension icon and "Detect & Convert JSON"</li>
            <li>Click "Open Table Viewer" - should open in <100ms</li>
            <li>Test smooth scrolling through 10,000 rows</li>
            <li>Click object/array badges to test modal performance</li>
            <li>Try searching - should be <50ms response time</li>
        </ol>
    </div>

    <!-- Large synthetic dataset for performance testing -->
    <script type="application/json" id="large-dataset">
    {
      "users": [
        // 10,000 records will be generated by the script below
      ]
    }
    </script>

    <script>
        // Generate large synthetic dataset for performance testing
        function generateLargeDataset() {
            const users = [];
            const firstNames = ['John', 'Jane', 'Mike', 'Sarah', 'David', 'Emily', 'Chris', 'Lisa', 'Tom', 'Anna'];
            const lastNames = ['Smith', 'Johnson', 'Williams', 'Brown', 'Jones', 'Garcia', 'Miller', 'Davis', 'Rodriguez', 'Martinez'];
            const cities = ['New York', 'Los Angeles', 'Chicago', 'Houston', 'Phoenix', 'Philadelphia', 'San Antonio', 'San Diego', 'Dallas', 'San Jose'];
            const departments = ['Engineering', 'Marketing', 'Sales', 'HR', 'Finance', 'Operations', 'Support', 'Design', 'Legal', 'Analytics'];
            
            console.time('Dataset Generation');
            
            for (let i = 1; i <= 10000; i++) {
                const user = {
                    id: i,
                    name: `${firstNames[i % firstNames.length]} ${lastNames[i % lastNames.length]}`,
                    email: `user${i}@company.com`,
                    age: 22 + (i % 43), // Ages 22-64
                    salary: 45000 + (i * 13) % 100000, // Salaries 45k-145k
                    department: departments[i % departments.length],
                    isActive: i % 3 !== 0, // ~67% active
                    joinDate: new Date(2020 + (i % 4), (i % 12), (i % 28) + 1).toISOString(),
                    
                    // Nested objects for performance testing
                    address: {
                        street: `${100 + (i % 900)} ${lastNames[i % lastNames.length]} St`,
                        city: cities[i % cities.length],
                        zipCode: `${10000 + (i % 90000)}`,
                        country: 'USA'
                    },
                    
                    // Arrays for performance testing
                    skills: [
                        `Skill ${(i % 10) + 1}`,
                        `Technology ${(i % 15) + 1}`,
                        `Framework ${(i % 8) + 1}`
                    ],
                    
                    // Performance metrics object
                    metrics: {
                        tasksCompleted: i % 150,
                        averageRating: 3.0 + (i % 20) / 10, // 3.0-4.9
                        projectCount: (i % 25) + 1,
                        lastReviewDate: new Date(2024, (i % 12), (i % 28) + 1).toISOString()
                    },
                    
                    // Large text field for testing
                    bio: `This is a bio for user ${i}. `.repeat((i % 5) + 1),
                    
                    // Complex nested structure
                    preferences: {
                        theme: i % 2 === 0 ? 'dark' : 'light',
                        notifications: {
                            email: i % 3 === 0,
                            push: i % 2 === 0,
                            sms: i % 5 === 0
                        },
                        privacy: {
                            profileVisible: i % 4 !== 0,
                            shareData: i % 6 === 0
                        }
                    }
                };
                
                users.push(user);
            }
            
            console.timeEnd('Dataset Generation');
            console.log(`Generated ${users.length} records for performance testing`);
            
            return { users };
        }

        // Replace the JSON content
        document.addEventListener('DOMContentLoaded', function() {
            const script = document.getElementById('large-dataset');
            const data = generateLargeDataset();
            script.textContent = JSON.stringify(data, null, 2);
            
            // Show generation stats
            const stats = document.createElement('div');
            stats.style.cssText = 'background: #f0fdf4; padding: 15px; border-radius: 6px; margin: 20px 0; border-left: 4px solid #10b981;';
            stats.innerHTML = `
                <strong>‚úÖ Dataset Generated Successfully!</strong>
                <ul style="margin: 10px 0 0 0;">
                    <li><strong>Records:</strong> 10,000 users</li>
                    <li><strong>Columns:</strong> 12 main + nested properties</li>
                    <li><strong>Objects:</strong> address, metrics, preferences (nested)</li>
                    <li><strong>Arrays:</strong> skills (3 items each)</li>
                    <li><strong>Size:</strong> ~${Math.round(JSON.stringify(data).length / 1024)} KB</li>
                </ul>
            `;
            document.body.appendChild(stats);
        });
    </script>

    <div style="margin-top: 40px; padding: 20px; background: #f8f9fa; border-radius: 8px;">
        <h3>üìä Expected Performance Metrics:</h3>
        <ul>
            <li><strong>Initial Render:</strong> &lt;100ms for 10,000 rows</li>
            <li><strong>Scrolling:</strong> Smooth 60fps with virtual scrolling</li>
            <li><strong>Search:</strong> &lt;50ms response time using JSON.stringify optimization</li>
            <li><strong>Modal Opening:</strong> &lt;20ms for object/array expansion</li>
            <li><strong>Memory Usage:</strong> &lt;50MB total (including browser overhead)</li>
            <li><strong>Cache Management:</strong> Automatic cleanup prevents memory leaks</li>
        </ul>
    </div>

    <div style="margin-top: 20px; padding: 15px; background: #fef3c7; border-radius: 6px; border-left: 4px solid #f59e0b;">
        <strong>üîß Technical Improvements:</strong>
        <ul>
            <li><strong>Fixed Row Heights:</strong> Eliminates expensive dynamic calculations</li>
            <li><strong>Render Caching:</strong> 1000-item LRU cache prevents re-rendering</li>
            <li><strong>Modal Pattern:</strong> Single modal instead of inline expansions</li>
            <li><strong>Event Delegation:</strong> One click handler for entire table</li>
            <li><strong>RequestAnimationFrame:</strong> Optimized rendering pipeline</li>
            <li><strong>Viewport-based Sizing:</strong> Dynamic visible row calculation</li>
        </ul>
    </div>
</body>
</html>
