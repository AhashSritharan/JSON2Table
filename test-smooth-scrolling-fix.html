<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>JSON2Table - Smooth Scrolling Fix Test</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            line-height: 1.6;
        }
        .header {
            text-align: center;
            margin-bottom: 40px;
            padding: 20px;
            background: linear-gradient(135deg, #059669 0%, #047857 100%);
            color: white;
            border-radius: 10px;
        }
        .fix-section {
            background: #ecfdf5;
            padding: 20px;
            border-radius: 8px;
            margin-bottom: 30px;
            border-left: 4px solid #10b981;
        }
        .test-note {
            background: #fef3c7;
            padding: 15px;
            border-radius: 6px;
            margin-bottom: 20px;
            border-left: 4px solid #f59e0b;
        }
    </style>
</head>
<body>
    <div class="header">
        <h1>🔧 Smooth Scrolling & Header Fix</h1>
        <p>Testing fixes for jumpy scrolling and header overlap issues</p>
    </div>

    <div class="fix-section">
        <h3>🎯 Issues Fixed:</h3>
        <ul>
            <li><strong>Jumpy Scrolling:</strong> Fixed virtual scrolling to account for variable row heights when expansions are open</li>
            <li><strong>Header Overlap:</strong> Improved sticky header z-index and background to prevent overlap with expanded content</li>
            <li><strong>Accurate Height Calculation:</strong> Now properly calculates row heights including expanded arrays and objects</li>
            <li><strong>Smooth Scroll Handler:</strong> Replaced setTimeout with requestAnimationFrame for butter-smooth scrolling</li>
        </ul>
    </div>

    <div class="test-note">
        <h3>🧪 Test Instructions:</h3>
        <ol>
            <li><strong>Activate the extension</strong> and convert this JSON</li>
            <li><strong>Expand some arrays</strong> (reviews, features) by clicking their badges</li>
            <li><strong>Expand some objects</strong> (specifications, availability) by clicking their badges</li>
            <li><strong>Test scrolling:</strong> Should be smooth without jumping between positions</li>
            <li><strong>Check header:</strong> Table header should stay visible and not overlap with expanded content</li>
            <li><strong>Try rapid scrolling:</strong> Should respond smoothly without lag or jumping</li>
        </ol>
    </div>

    <script type="application/json">
[
  {
    "id": 1,
    "title": "iPhone 15 Pro Max",
    "price": 1199.99,
    "category": "Smartphone",
    "brand": "Apple",
    "description": "The most advanced iPhone with titanium design",
    "specifications": {
      "processor": "A17 Pro",
      "memory": "256GB",
      "display": "6.7-inch Super Retina XDR",
      "camera": "48MP Pro Camera System",
      "battery": "Up to 29 hours video playback",
      "connectivity": "5G, WiFi 6E, Bluetooth 5.3"
    },
    "reviews": [
      {
        "rating": 5,
        "comment": "Absolutely fantastic! The camera quality is incredible and performance is lightning fast.",
        "date": "2024-01-15T10:30:00Z",
        "reviewerName": "John Smith",
        "reviewerEmail": "john.smith@example.com",
        "verified": true
      },
      {
        "rating": 4,
        "comment": "Great phone but very expensive. Camera and display are top-notch.",
        "date": "2024-01-12T14:22:00Z",
        "reviewerName": "Sarah Johnson",
        "reviewerEmail": "sarah.j@example.com",
        "verified": true
      },
      {
        "rating": 5,
        "comment": "Worth every penny! The titanium build feels premium.",
        "date": "2024-01-10T09:45:00Z",
        "reviewerName": "Mike Chen",
        "reviewerEmail": "mike.chen@example.com",
        "verified": false
      }
    ],
    "features": ["Face ID", "Action Button", "Wireless Charging", "5G Compatible", "Water Resistant IP68", "Emergency SOS", "Crash Detection"],
    "availability": {
      "inStock": true,
      "quantity": 150,
      "warehouse": "West Coast Distribution",
      "estimatedDelivery": "2024-01-20T09:00:00Z",
      "shippingOptions": ["Standard", "Express", "Overnight"],
      "returnPolicy": "30 days"
    }
  },
  {
    "id": 2,
    "title": "MacBook Pro M3 16-inch",
    "price": 2499.99,
    "category": "Laptop",
    "brand": "Apple",
    "description": "Professional laptop with M3 Pro chip for demanding workflows",
    "specifications": {
      "processor": "M3 Pro 12-core CPU",
      "memory": "18GB Unified Memory",
      "storage": "512GB SSD",
      "display": "16.2-inch Liquid Retina XDR",
      "graphics": "18-core GPU",
      "ports": "3x Thunderbolt 4, HDMI, SDXC, MagSafe 3"
    },
    "reviews": [
      {
        "rating": 5,
        "comment": "Perfect for video editing! Handles 4K footage like a dream.",
        "date": "2024-01-10T16:45:00Z",
        "reviewerName": "Mike Chen",
        "reviewerEmail": "mike.chen@example.com",
        "verified": true
      },
      {
        "rating": 4,
        "comment": "Powerful machine but gets warm under heavy load.",
        "date": "2024-01-08T11:30:00Z",
        "reviewerName": "Lisa Park",
        "reviewerEmail": "lisa.park@example.com",
        "verified": true
      }
    ],
    "features": ["Touch ID", "Magic Keyboard", "Force Touch Trackpad", "Thunderbolt 4", "Studio-quality mics", "Six-speaker sound"],
    "availability": {
      "inStock": false,
      "quantity": 0,
      "warehouse": "East Coast Distribution",
      "estimatedDelivery": "2024-02-01T09:00:00Z",
      "shippingOptions": ["Standard", "Express"],
      "returnPolicy": "30 days"
    }
  },
  {
    "id": 3,
    "title": "AirPods Pro (2nd Gen)",
    "price": 249.99,
    "category": "Audio",
    "brand": "Apple",
    "description": "Active Noise Cancellation wireless earbuds with spatial audio",
    "specifications": {
      "connectivity": "Bluetooth 5.3",
      "battery": "6 hours + 24 hours with case",
      "features": "Active Noise Cancellation, Transparency Mode",
      "charging": "Lightning, Wireless (Qi), MagSafe",
      "water_resistance": "IPX4",
      "chip": "H2 chip"
    },
    "reviews": [
      {
        "rating": 4,
        "comment": "Great sound quality and excellent noise cancellation for commuting.",
        "date": "2024-01-08T12:30:00Z",
        "reviewerName": "Lisa Park",
        "reviewerEmail": "lisa.park@example.com",
        "verified": true
      },
      {
        "rating": 5,
        "comment": "Perfect for workouts! Secure fit and great audio quality.",
        "date": "2024-01-05T08:15:00Z",
        "reviewerName": "David Kim",
        "reviewerEmail": "david.kim@example.com",
        "verified": true
      },
      {
        "rating": 5,
        "comment": "Best earbuds I've ever owned. Spatial audio is mind-blowing!",
        "date": "2024-01-03T19:20:00Z",
        "reviewerName": "Emma Wilson",
        "reviewerEmail": "emma.w@example.com",
        "verified": false
      }
    ],
    "features": ["Spatial Audio", "Transparency Mode", "Touch Controls", "Water Resistant", "Adaptive EQ", "Find My support"],
    "availability": {
      "inStock": true,
      "quantity": 75,
      "warehouse": "Central Distribution",
      "estimatedDelivery": "2024-01-18T09:00:00Z",
      "shippingOptions": ["Standard", "Express", "Overnight"],
      "returnPolicy": "30 days"
    }
  },
  {
    "id": 4,
    "title": "iPad Pro 12.9-inch M2",
    "price": 1099.99,
    "category": "Tablet",
    "brand": "Apple",
    "description": "Ultimate iPad experience with M2 chip and Liquid Retina XDR display",
    "specifications": {
      "processor": "M2 chip 8-core CPU",
      "memory": "8GB RAM",
      "storage": "128GB",
      "display": "12.9-inch Liquid Retina XDR",
      "camera": "12MP Ultra Wide front, 12MP Wide back",
      "connectivity": "Wi-Fi 6E, Bluetooth 5.3"
    },
    "reviews": [
      {
        "rating": 5,
        "comment": "Incredible display and performance. Perfect for digital art and productivity.",
        "date": "2024-01-07T14:00:00Z",
        "reviewerName": "Alex Rodriguez",
        "reviewerEmail": "alex.r@example.com",
        "verified": true
      },
      {
        "rating": 4,
        "comment": "Amazing tablet but the Magic Keyboard is expensive separately.",
        "date": "2024-01-04T10:15:00Z",
        "reviewerName": "Jennifer Lee",
        "reviewerEmail": "jen.lee@example.com",
        "verified": true
      }
    ],
    "features": ["Apple Pencil 2 support", "Magic Keyboard compatible", "Face ID", "USB-C", "ProRes video recording", "LiDAR Scanner"],
    "availability": {
      "inStock": true,
      "quantity": 45,
      "warehouse": "West Coast Distribution",
      "estimatedDelivery": "2024-01-19T09:00:00Z",
      "shippingOptions": ["Standard", "Express"],
      "returnPolicy": "30 days"
    }
  },
  {
    "id": 5,
    "title": "Apple Watch Series 9",
    "price": 399.99,
    "category": "Wearable",
    "brand": "Apple",
    "description": "Advanced health monitoring and fitness tracking smartwatch",
    "specifications": {
      "processor": "S9 SiP",
      "display": "45mm Always-On Retina",
      "battery": "Up to 18 hours",
      "connectivity": "GPS, Cellular optional",
      "sensors": "Blood Oxygen, ECG, Temperature",
      "materials": "Aluminum case, Sport Band"
    },
    "reviews": [
      {
        "rating": 5,
        "comment": "Excellent health tracking features. Love the new gesture controls!",
        "date": "2024-01-06T16:30:00Z",
        "reviewerName": "Sarah Mitchell",
        "reviewerEmail": "sarah.m@example.com",
        "verified": true
      },
      {
        "rating": 4,
        "comment": "Great fitness companion but battery could be better.",
        "date": "2024-01-02T13:45:00Z",
        "reviewerName": "Tom Anderson",
        "reviewerEmail": "tom.a@example.com",
        "verified": true
      }
    ],
    "features": ["Double Tap gesture", "Health monitoring", "Fitness tracking", "Water resistant", "Siri", "Emergency SOS"],
    "availability": {
      "inStock": true,
      "quantity": 120,
      "warehouse": "Central Distribution",
      "estimatedDelivery": "2024-01-17T09:00:00Z",
      "shippingOptions": ["Standard", "Express", "Overnight"],
      "returnPolicy": "30 days"
    }
  }
]
    </script>

    <div style="margin-top: 30px; padding: 15px; background: #dcfce7; border-radius: 6px; border-left: 4px solid #16a34a;">
        <strong>✅ Expected Improvements:</strong>
        <ul>
            <li><strong>Smooth Scrolling:</strong> No more jumping between scroll positions</li>
            <li><strong>Accurate Positioning:</strong> Virtual scrolling accounts for expanded content height</li>
            <li><strong>Header Visibility:</strong> Table header stays properly positioned above content</li>
            <li><strong>Responsive Performance:</strong> Faster scroll response with requestAnimationFrame</li>
            <li><strong>Better Z-index Management:</strong> Prevents content overlap issues</li>
        </ul>
    </div>

    <div style="margin-top: 20px; padding: 15px; background: #e0f2fe; border-radius: 6px; border-left: 4px solid #0284c7;">
        <strong>🔍 Specific Tests:</strong>
        <ol>
            <li><strong>Expand multiple arrays:</strong> Open reviews for several products and scroll smoothly</li>
            <li><strong>Mix expansions:</strong> Open both arrays and objects, then test scrolling behavior</li>
            <li><strong>Rapid scrolling:</strong> Scroll quickly up and down - should be smooth without jumping</li>
            <li><strong>Header check:</strong> Scroll while expansions are open - header should remain visible and properly positioned</li>
            <li><strong>Performance test:</strong> Open many expansions and verify scrolling remains responsive</li>
        </ol>
    </div>
</body>
</html>
